---
title: "EXPLORATORY DATA ANALYSIS"
output: html_document
date: "2025-03-10"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ggplot2)
library(lubridate)
library(ggcorrplot)
```

# Load the data
```{r}
intervals <- read.csv("C:/Users/JDS221/GWU/DATS6101/projects/DATS6101_Project/data/fitbit/timestep_data/intervals.csv")

head(intervals)
str(intervals)
summary(intervals$avg_steps)
summary(intervals$avg_sleep)
```
# Clean the data
```{r}
intervals <- na.omit(intervals)

#intervals$time_only <- format(as.POSIXct(intervals$interval_start), format = "%H:%M:%S")
intervals$time_only <- ifelse(nchar(intervals$interval_start) >= 19,
                       substr(intervals$interval_start, 12, 19),
                       "00:00:00")

intervals$day_of_week <- factor(intervals$day_of_week, levels = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
```

# 
```{r}
steps_and_sleep <- intervals 
```

# Normalize steps and sleep
```{r}
steps_and_sleep <- steps_and_sleep %>%
  mutate(
    norm_steps = (avg_steps - min(avg_steps)) / (max(avg_steps) - min(avg_steps)),
    norm_sleep = (avg_sleep - min(avg_sleep)) / (max(avg_sleep) - min(avg_sleep))
  )
```

# Calculate opportunity score
```{r}
weight_steps <- 0.2
weight_sleep <- 0.8

steps_and_sleep <- steps_and_sleep %>%
  mutate(
    opportunity_score = weight_steps * (1 - norm_steps) + weight_sleep * (1 - norm_sleep)  # lower steps and sleep = higher score
  )
```
**opportunity_score: ** The higher the score, the more ideal the time-slot is for a marketing ad. We chose to weight sleep at 0.8 and steps at 0.2 due to the fact that if a person is sleeping there is no chance they will see the ad.

```{r}
ggplot(steps_and_sleep, aes(x = time_only, y = opportunity_score)) +
  geom_col(fill = "darkorange") +
  labs(title = "Opportunity Score by 10 Minute Interval (Best Time for TV Ads)",
       x = "10 Second Intervals (Military Time)",
       y = "Opportunity Score") +
  #scale_x_discrete(breaks = steps_and_sleep$time_only[seq(1, length(steps_and_sleep$time_only), by = 1000)]) +
  #theme(axis.text.x = element_text(angle = 45, hjust = 1))
  theme(axis.text.x = element_blank())
```
**The bar plot shows the opportunity score throughout various time intervals, where higher bar shows better time slots for marketing ads (thus higher opportunity scores). This shows where ad placement times have higher opportunity periods based on a combination of step/sleep data**

```{r}
steps_and_sleep %>%
  arrange(desc(opportunity_score)) %>%
  select(time_only, opportunity_score)
```

```{r}
qqnorm(steps_and_sleep$opportunity_score)
qqline(steps_and_sleep$opportunity_score, col = "red")
```
**QQ Norm Analysis:** Data mostly falls on the line, therefore the data is reasonably normal. Based on our EDA, the more important plot is the Steps Taken, as it will best answer our SMART question.**

## Statistical Testing

# ANOVA Test For Opportunity Score
**Goal of this test is to determine if there is a meaningful difference between the different hours opportunity scores**
```{r}
anova_test = aov(opportunity_score ~ factor(time_only), data = steps_and_sleep)
summary(anova_test)
```
**Interpreting the ANOVA Test: ** Sum of squares between each interval is larger than the sum of squares within the intervals. Additionally, the p-value < 0.001 and therefore we know that the 10 minute intervals are statistically significant when it comes to marketing opportunity (per the score we created). Note, this only tells us that some times are better than others.


# Post-hoc Turkey
```{r}
post_cod_result <- TukeyHSD(anova_test)
post_cod_result
```
** Interpreting Tukey's Honest Significant Difference Test: ** This is performed after the ANOVA test to see which specific time intervals have significantly different opportunity scores. If the confidence interval of a time pair doesn't include a 0, it means their opportunity scores are significantly different. Large absolute differences in means show that some intervals are greater for marketing opportunities. Post-hoc Tukey helps show the exact time intervals where marketing efforts should be highlighted instead of knowing where the differences exist (as analyzed by ANOVA).
