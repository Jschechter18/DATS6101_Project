---
title: "Exploratory Data Analysis"
author: "Your Name"
date: "03/03/2025"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Install necessary packages
```{r}
#install.packages("tidyverse")
#install.packages("lubridate")
```

# Load necessary libraries
```{r}
library(tidyverse)
library(lubridate)
```

# Load the data
```{r}
steps <- read.csv("C:/Users/JDS221/GWU/DATS6101/projects/DATS6101_Project/data/fitbit/mturkfitbit_export_month1/minuteStepsNarrow_merged.csv")
heart_rate <- read.csv("C:/Users/JDS221/GWU/DATS6101/projects/DATS6101_Project/data/fitbit/mturkfitbit_export_month1/heartrate_seconds_merged.csv")
sleep <- read.csv("C:/Users/JDS221/GWU/DATS6101/projects/DATS6101_Project/data/fitbit/mturkfitbit_export_month1/minuteSleep_merged.csv")
intensity <- read.csv("C:/Users/JDS221/GWU/DATS6101/projects/DATS6101_Project/data/fitbit/mturkfitbit_export_month1/minuteIntensitiesNarrow_merged.csv")
calories <- read.csv("C:/Users/JDS221/GWU/DATS6101/projects/DATS6101_Project/data/fitbit/mturkfitbit_export_month1/minuteCaloriesNarrow_merged.csv")
mets <- read.csv("C:/Users/JDS221/GWU/DATS6101/projects/DATS6101_Project/data/fitbit/mturkfitbit_export_month1/minuteMETsNarrow_merged.csv")
```

# Ensure time is correctly formated
```{r}
# , orders = c("mdy HMS", "mdy HM")
steps$ActivityMinute <- parse_date_time(steps$ActivityMinute, orders = "mdy IMS p")
heart_rate$ActivityMinute <- parse_date_time(heart_rate$Time, orders = "mdy IMS p")
sleep$ActivityMinute <- parse_date_time(sleep$date, orders = "mdy IMS p")
intensity$ActivityMinute <- parse_date_time(intensity$ActivityMinute, "mdy IMS p")
calories$ActivityMinute <- parse_date_time(calories$ActivityMinute, "mdy IMS p")
mets$ActivityMinute <- parse_date_time(mets$ActivityMinute, orders = "mdy IMS p")
```

```{r}
sleep$value <- ifelse(sleep$value == 1, 1, 0)
sleep
```

```{r}
steps$HourMilitary <- format(steps$ActivityMinute, "%H:%M")
```

# Summarize data to 8-minute intervals
```{r}
interval_steps <- steps %>%
  mutate(interval_start = floor_date(ActivityMinute, unit = "10 minutes")) %>%
  group_by(interval_start) %>%
  summarise(avg_steps = mean(Steps, na.rm = TRUE), .groups = "drop") 

interval_sleep <- sleep %>%
  mutate(interval_start = floor_date(ActivityMinute, unit = "10 minutes")) %>%
  group_by(interval_start) %>%
  summarise(avg_sleep = mean(value, na.rm = TRUE), .groups = "drop")

interval_intensity <- intensity %>%
  mutate(interval_start = floor_date(ActivityMinute, unit = "10 minutes")) %>%
  group_by(interval_start) %>%
  summarise(avg_intensity = mean(Intensity, na.rm = TRUE), .groups = "drop")

interval_calories <- calories %>%
  mutate(interval_start = floor_date(ActivityMinute, unit = "10 minutes")) %>%
  group_by(interval_start) %>%
  summarise(avg_calories = mean(Calories, na.rm = TRUE), .groups = "drop")

interval_mets <- mets %>%
  mutate(interval_start = floor_date(ActivityMinute, unit = "10 minutes")) %>%
  group_by(interval_start) %>%
  summarise(avg_mets = mean(METs, na.rm = TRUE), .groups = "drop")
```


# Merge datasets
```{r}
interval_data <- interval_steps %>%
  left_join(interval_sleep, by = c("interval_start")) %>%
  left_join(interval_intensity, by = c("interval_start")) %>%
  left_join(interval_calories, by = c("interval_start")) %>%
  left_join(interval_mets, by = c("interval_start"))
```

# Add day of week
# Add day of the week column
# Add a military time column
```{r}
interval_data <- interval_data %>%
  mutate(day_of_week = wday(interval_start, label = TRUE, abbr = FALSE))


interval_data <- interval_data %>%
  mutate(hour_military = format(interval_start, "%H"))
```


# Output our new dataframe to a csv, and use this csv for EDA
```{r}
write.csv(interval_data, "C:/Users/JDS221/GWU/DATS6101/projects/DATS6101_Project/data/fitbit/timestep_data/intervals.csv", row.names = FALSE)
```


